<%- include('../partials/head.ejs') %>

    <body class="bg-gray-50 text-gray-700 flex flex-col min-h-screen">
        <%- include('../partials/navbar.ejs') %>

            <main class="flex-grow pt-24 pb-12">
                <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-8">Shopping Cart</h1>

                    <% if (products.length> 0) { %>
                        <div class="flex flex-col lg:flex-row gap-8">
                            <!-- Cart Items -->
                            <div class="flex-1">
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden mb-6">
                                    <div
                                        class="p-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
                                        <span class="font-semibold text-gray-700">Items (<%= products.length %>)</span>
                                        <form action="/cart-clear" method="POST">
                                            <button type="submit"
                                                class="text-red-500 hover:text-red-700 text-sm font-medium flex items-center gap-1 transition-colors">
                                                <i class="fas fa-trash-alt"></i> Clear Cart
                                            </button>
                                        </form>
                                    </div>
                                    <ul class="divide-y divide-gray-100">
                                        <% products.forEach(p=> { %>
                                            <li
                                                class="p-6 flex flex-col sm:flex-row items-start gap-6 hover:bg-gray-50 transition-colors">
                                                <div
                                                    class="w-24 h-24 bg-white rounded-lg border border-gray-200 flex items-center justify-center p-2 flex-shrink-0">
                                                    <img src="<%= (p.product.imageUrls && p.product.imageUrls.length > 0) ? p.product.imageUrls[0] : '/images/placeholder.png' %>"
                                                        class="max-w-full max-h-full object-contain mix-blend-multiply">
                                                </div>
                                                <div class="flex-1 w-full">
                                                    <div class="flex justify-between items-start mb-2">
                                                        <div>
                                                            <h3 class="text-lg font-bold text-gray-900">
                                                                <%= p.product.brand %>
                                                                    <%= p.product.model %>
                                                            </h3>
                                                            <p class="text-sm text-gray-500">
                                                                <%= p.product.category %>
                                                            </p>
                                                        </div>
                                                        <div class="text-right">
                                                            <div class="text-cyan-600 font-bold text-lg">&#8377;<%=
                                                                    p.product.price.toLocaleString('en-IN') %>
                                                            </div>
                                                            <% if(p.product.mrp> p.product.price) { %>
                                                                <div class="text-xs text-gray-400 line-through">&#8377;
                                                                    <%= p.product.mrp.toLocaleString('en-IN') %>
                                                                </div>
                                                                <% } %>
                                                        </div>
                                                    </div>

                                                    <!-- Specifications -->
                                                    <div class="flex flex-wrap gap-2 mb-4">
                                                        <% if(p.product.specifications) { %>
                                                            <% if(p.product.specifications.processor) { %>
                                                                <span
                                                                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-700 border border-gray-200">
                                                                    <i class="fas fa-microchip mr-1 text-cyan-600"></i>
                                                                    <%= p.product.specifications.processor %>
                                                                </span>
                                                                <% } %>
                                                                    <% if(p.product.specifications.ram) { %>
                                                                        <span
                                                                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-700 border border-gray-200">
                                                                            <i
                                                                                class="fas fa-memory mr-1 text-cyan-600"></i>
                                                                            <%= p.product.specifications.ram %>
                                                                        </span>
                                                                        <% } %>
                                                                            <% if(p.product.specifications.storage) { %>
                                                                                <span
                                                                                    class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-700 border border-gray-200">
                                                                                    <i
                                                                                        class="fas fa-hdd mr-1 text-cyan-600"></i>
                                                                                    <%= p.product.specifications.storage
                                                                                        %>
                                                                                </span>
                                                                                <% } %>
                                                                                    <% } %>
                                                    </div>

                                                    <div class="flex justify-between items-center">
                                                        <div
                                                            class="flex items-center gap-3 bg-gray-100 rounded-lg px-3 py-1">
                                                            <span class="text-xs text-gray-500 font-medium">Qty:</span>
                                                            <span class="font-bold text-gray-900">
                                                                <%= p.quantity %>
                                                            </span>
                                                        </div>
                                                        <form action="/cart-delete-item" method="POST">
                                                            <input type="hidden" value="<%= p.product._id %>"
                                                                name="productId">
                                                            <input type="hidden" value="<%= p.product.price %>"
                                                                name="price">
                                                            <button type="submit"
                                                                class="text-gray-400 hover:text-red-500 transition-colors p-2"
                                                                title="Remove Item">
                                                                <i class="fas fa-trash-alt"></i>
                                                            </button>
                                                        </form>
                                                    </div>
                                                </div>
                                            </li>
                                            <% }) %>
                                    </ul>
                                </div>
                                <div class="text-left">
                                    <a href="/"
                                        class="text-cyan-600 hover:text-cyan-700 text-sm font-medium transition-colors inline-flex items-center gap-1">
                                        <i class="fas fa-arrow-left"></i> Continue Shopping
                                    </a>
                                </div>
                            </div>

                            <!-- Order Summary -->
                            <div class="lg:w-96">
                                <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 sticky top-24">
                                    <h2 class="text-lg font-bold text-gray-900 mb-4">Order Summary</h2>
                                    <div class="space-y-3 mb-6">
                                        <div class="flex justify-between text-gray-600">
                                            <span>Subtotal</span>
                                            <span>&#8377;<%= totalPrice.toLocaleString('en-IN') %></span>
                                        </div>
                                        <div class="flex justify-between text-gray-600">
                                            <span>Shipping</span>
                                            <span class="text-cyan-600">Free</span>
                                        </div>
                                        <div
                                            class="border-t border-gray-100 pt-3 flex justify-between font-bold text-gray-900 text-lg">
                                            <span>Total</span>
                                            <span>&#8377;<%= totalPrice.toLocaleString('en-IN') %></span>
                                        </div>
                                    </div>

                                    <form action="/checkout" method="POST">
                                        <button type="submit"
                                            class="w-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg shadow-cyan-200 transition-all transform hover:-translate-y-1 flex items-center justify-center gap-2">
                                            <i class="fab fa-whatsapp text-xl"></i> Order via WhatsApp
                                        </button>
                                    </form>
                                    <p class="text-xs text-gray-400 text-center mt-4">
                                        <i class="fas fa-lock mr-1"></i> Secure Checkout
                                    </p>
                                </div>
                            </div>
                        </div>

                        <% } else { %>
                            <div
                                class="text-center py-16 bg-white rounded-2xl shadow-sm border border-gray-100 max-w-2xl mx-auto">
                                <div
                                    class="w-20 h-20 bg-cyan-50 rounded-full flex items-center justify-center mx-auto mb-6 text-cyan-200">
                                    <i class="fas fa-shopping-cart text-3xl text-cyan-400"></i>
                                </div>
                                <h2 class="text-2xl font-bold text-gray-900 mb-3">Your cart is empty</h2>
                                <p class="text-gray-500 mb-8 max-w-md mx-auto">Looks like you haven't added anything
                                    yet. Explore our collection of premium refurbished laptops.</p>
                                <a href="/"
                                    class="inline-block bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-8 rounded-xl transition-colors shadow-lg shadow-cyan-200">
                                    Start Shopping
                                </a>
                            </div>
                            <% } %>

                                <!-- You May Also Like Section -->
                                <% if (typeof recommendations !=='undefined' && recommendations.length> 0) { %>
                                    <div class="mt-16 border-t border-gray-200 pt-12">
                                        <h2 class="text-2xl font-bold text-gray-900 mb-8">You May Also Like</h2>
                                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                                            <% recommendations.forEach(item=> {
                                                const itemDiscount = item.mrp - item.price;
                                                const itemDiscountPercent = Math.round((itemDiscount / item.mrp) * 100);
                                                %>
                                                <a href="/laptop/<%= item._id %>"
                                                    class="bg-white border border-gray-200 rounded-xl p-4 hover:shadow-lg transition-all duration-300 flex flex-col group h-full">
                                                    <div
                                                        class="relative w-full h-40 mb-4 flex items-center justify-center bg-gray-50 rounded-lg p-2 overflow-hidden">
                                                        <img src="<%= (item.imageUrls && item.imageUrls.length > 0) ? item.imageUrls[0] : '/images/placeholder.png' %>"
                                                            alt="<%= item.brand %>"
                                                            class="max-h-full max-w-full object-contain mix-blend-multiply transition-transform duration-300 group-hover:scale-105">
                                                        <% if(itemDiscountPercent> 0) { %>
                                                            <span
                                                                class="absolute top-2 left-2 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full">
                                                                <%= itemDiscountPercent %>% OFF
                                                            </span>
                                                            <% } %>
                                                    </div>
                                                    <div class="flex-1 flex flex-col">
                                                        <h3
                                                            class="font-bold text-gray-900 text-sm leading-tight mb-1 line-clamp-2">
                                                            <%= item.brand %>
                                                                <%= item.model %>
                                                        </h3>
                                                        <div class="flex flex-wrap gap-1 mb-3">
                                                            <% if(item.specifications && item.specifications.processor)
                                                                { %>
                                                                <span
                                                                    class="text-[10px] text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded">
                                                                    <%= item.specifications.processor %>
                                                                </span>
                                                                <% } %>
                                                                    <% if(item.specifications &&
                                                                        item.specifications.ram) { %>
                                                                        <span
                                                                            class="text-[10px] text-gray-500 bg-gray-100 px-1.5 py-0.5 rounded">
                                                                            <%= item.specifications.ram %>
                                                                        </span>
                                                                        <% } %>
                                                        </div>
                                                        <div class="mt-auto flex items-end justify-between">
                                                            <div>
                                                                <span class="text-lg font-bold text-gray-900">&#8377;<%=
                                                                        item.price.toLocaleString('en-IN') %></span>
                                                                <% if(item.mrp> item.price) { %>
                                                                    <span
                                                                        class="text-xs text-gray-400 line-through ml-1">&#8377;
                                                                        <%= item.mrp.toLocaleString('en-IN') %>
                                                                    </span>
                                                                    <% } %>
                                                            </div>
                                                            <button
                                                                class="w-8 h-8 rounded-full bg-cyan-50 text-cyan-600 flex items-center justify-center hover:bg-cyan-500 hover:text-white transition-colors">
                                                                <i class="fas fa-plus text-xs"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </a>
                                                <% }) %>
                                        </div>
                                    </div>
                                    <% } %>

                </div>
            </main>

            <%- include('../partials/footer.ejs') %>
    </body>

    </html>