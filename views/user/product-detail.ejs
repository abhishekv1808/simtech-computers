<%- include('../partials/head.ejs') %>

    <body>
        <%- include('../partials/navbar.ejs') %>

            <main class="bg-gray-50 min-h-screen py-8">
                <!-- Breadcrumb -->
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mb-6 text-sm text-gray-500">
                    <a href="/" class="hover:text-cyan-600">Home</a>
                    <span class="mx-2">></span>
                    <a href="/laptops" class="hover:text-cyan-600">Buy Refurbished Laptop</a>
                    <span class="mx-2">></span>
                    <a href="/brand/<%= laptop.brand %>" class="hover:text-cyan-600">
                        <%= laptop.brand %>
                    </a>
                    <span class="mx-2">></span>
                    <span class="text-gray-900 font-medium">
                        <%= laptop.model %>
                    </span>
                </div>

                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="bg-white rounded-xl shadow-sm p-6 md:p-8">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">

                            <!-- Left Column: Images -->
                            <div class="space-y-4">
                                <div class="flex gap-4">
                                    <!-- Thumbnails -->
                                    <div class="hidden md:flex flex-col gap-3 w-20">
                                        <% if(laptop.imageUrls && laptop.imageUrls.length> 0) { %>
                                            <% laptop.imageUrls.forEach((url, index)=> { %>
                                                <div class="cursor-pointer border-2 <%= index === 0 ? 'border-cyan-500' : 'border-gray-200' %> rounded-lg overflow-hidden hover:border-cyan-500 transition-colors"
                                                    onclick="changeImage('<%= url %>', this)">
                                                    <img src="<%= url %>" alt="Thumbnail"
                                                        class="w-full h-16 object-contain p-1">
                                                </div>
                                                <% }) %>
                                                    <% } %>
                                    </div>

                                    <!-- Main Image -->
                                    <div
                                        class="flex-1 relative bg-gray-50 rounded-xl p-8 flex items-center justify-center min-h-[400px] border border-gray-100">
                                        <% if (laptop.stockQuantity === 0 || laptop.status === 'Out of Stock') { %>
                                            <div class="absolute inset-0 z-20 flex items-center justify-center pointer-events-none">
                                                <div class="bg-red-600 text-white text-lg font-bold px-6 py-2 rounded-full shadow-lg transform -rotate-6">
                                                    Out of Stock
                                                </div>
                                            </div>
                                        <% } %>
                                        <!-- Badge -->
                                        <div
                                            class="absolute top-4 left-4 bg-gray-900 text-white text-xs font-bold px-3 py-1.5 rounded-full flex items-center gap-2 z-10">
                                            <i class="fas fa-check-circle text-cyan-400"></i>
                                            <span>RG COMPUTERS ASSURED</span>
                                        </div>
                                        <div
                                            class="absolute top-4 right-4 text-gray-400 hover:text-red-500 cursor-pointer transition-colors">
                                            <i class="far fa-heart text-xl"></i>
                                        </div>

                                        <img id="main-image" src="<%= laptop.imageUrls[0] %>"
                                            alt="<%= laptop.brand %> <%= laptop.model %>"
                                            class="max-w-full max-h-[350px] object-contain mix-blend-multiply transition-transform duration-300 hover:scale-105">
                                    </div>
                                </div>

                                <!-- Mobile Thumbnails (Horizontal) -->
                                <div class="flex gap-3 overflow-x-auto md:hidden pb-2 no-scrollbar">
                                    <% if(laptop.imageUrls && laptop.imageUrls.length> 0) { %>
                                        <% laptop.imageUrls.forEach((url, index)=> { %>
                                            <div class="flex-shrink-0 w-16 h-16 cursor-pointer border-2 <%= index === 0 ? 'border-cyan-500' : 'border-gray-200' %> rounded-lg overflow-hidden"
                                                onclick="changeImage('<%= url %>', this)">
                                                <img src="<%= url %>" alt="Thumbnail"
                                                    class="w-full h-full object-contain p-1">
                                            </div>
                                            <% }) %>
                                                <% } %>
                                </div>

                                <!-- Warranty Info Banner -->
                                <div
                                    class="bg-black text-white p-3 rounded-lg flex items-center justify-between text-xs sm:text-sm font-medium">
                                    <div class="flex items-center gap-2">
                                        <span class="bg-gray-800 px-2 py-0.5 rounded">32</span>
                                        <span>Points Quality Check</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-cyan-400 font-bold">15</span>
                                        <span>Days Replacement</span>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <span class="text-cyan-400 font-bold">06</span>
                                        <span>Months Warranty</span>
                                    </div>
                                </div>

                                <!-- Product Description (Moved to Left Column) -->
                                <div class="mt-8 pt-6 border-t border-gray-100">
                                    <h3 class="font-bold text-gray-900 mb-3">Product Description</h3>
                                    <p class="text-gray-600 text-sm leading-relaxed">
                                        <%= laptop.description %>
                                    </p>
                                </div>
                            </div>

                            <!-- Right Column: Details -->
                            <div>
                                <h1 class="text-2xl font-bold text-gray-900 mb-2">
                                    <%= laptop.brand %>
                                        <%= laptop.model %> (<%= laptop.specifications.processor %>) - Refurbished
                                </h1>
                                <p class="text-gray-500 text-sm mb-4">RG Computers Warranty, Good, <%=
                                        laptop.specifications.ram %> / <%= laptop.specifications.storage %>
                                </p>

                                <!-- Rating -->
                                <div class="flex items-center gap-2 mb-6">
                                    <span
                                        class="bg-cyan-600 text-white text-xs font-bold px-2 py-1 rounded flex items-center gap-1">
                                        4.5 <i class="fas fa-star text-[10px]"></i>
                                    </span>
                                    <span class="text-sm text-gray-500">4 reviews</span>
                                </div>

                                <!-- Price Info -->
                                <div class="mb-6">
                                    <p class="text-red-500 text-xs font-semibold mb-1">â— Online Exclusive Price!</p>
                                    <div class="flex items-end gap-3">
                                        <span class="text-3xl font-bold text-gray-900">&#8377;<%=
                                                laptop.price.toLocaleString('en-IN') %></span>
                                        <span class="text-lg text-gray-400 line-through mb-1">&#8377;<%=
                                                laptop.mrp.toLocaleString('en-IN') %></span>
                                        <span class="text-lg font-bold text-red-500 mb-1">
                                            <%= discountPercent %>% OFF
                                        </span>
                                    </div>
                                </div>

                                <!-- Warranty Add-on -->
                                <div
                                    class="mb-6 bg-cyan-50 border border-cyan-100 rounded-lg p-3 flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div
                                            class="w-8 h-8 bg-cyan-100 rounded-full flex items-center justify-center text-cyan-600">
                                            <i class="fas fa-shield-alt"></i>
                                        </div>
                                        <div class="text-sm">
                                            <span class="font-bold text-gray-900">Extended Warranty</span>
                                            <p class="text-xs text-gray-600">Add 6 Months for &#8377;1,499</p>
                                        </div>
                                    </div>
                                    <button
                                        class="bg-black text-white text-xs font-bold px-4 py-2 rounded hover:bg-gray-800 transition-colors">
                                        Add
                                    </button>
                                </div>

                                <!-- Add to Cart / Buy Actions -->
                                <% if (laptop.stockQuantity > 0 && laptop.status !== 'Out of Stock') { %>
                                <div class="flex gap-4 mb-8">
                                    <form action="/cart" method="POST" class="flex-1">
                                        <input type="hidden" name="productId" value="<%= laptop._id %>">
                                        <button type="submit"
                                            class="w-full bg-white border border-gray-300 text-gray-900 font-bold py-3 px-6 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center gap-2">
                                            <i class="fas fa-shopping-cart"></i> Add to Cart
                                        </button>
                                    </form>
                                    <form action="/cart" method="POST" class="flex-1">
                                        <input type="hidden" name="productId" value="<%= laptop._id %>">
                                        <button type="submit"
                                            class="w-full bg-black text-white font-bold py-3 px-6 rounded-lg hover:bg-gray-800 transition-colors">
                                            Buy Now
                                        </button>
                                    </form>
                                </div>
                                <% } else { %>
                                <div class="w-full bg-red-50 text-red-600 font-bold py-4 rounded-lg border border-red-100 text-center mb-8 text-lg">
                                    Currently Out of Stock
                                </div>
                                <% } %>

                                <hr class="border-gray-200 mb-6">

                                <!-- Specifications Selection (Visual only mostly since specific product) -->
                                <div class="space-y-6">
                                    <div>
                                        <h3 class="font-bold text-gray-900 mb-3">Condition</h3>
                                        <div class="flex gap-3">
                                            <button
                                                class="px-4 py-2 border rounded-lg text-sm text-gray-400 border-gray-200 cursor-not-allowed"
                                                disabled>Fair</button>
                                            <button
                                                class="px-4 py-2 border-2 border-cyan-500 bg-cyan-50 text-cyan-700 font-bold rounded-lg text-sm relative">
                                                Good
                                                <i
                                                    class="fas fa-check-circle absolute -top-2 -right-2 text-cyan-500 bg-white rounded-full"></i>
                                            </button>
                                            <button
                                                class="px-4 py-2 border rounded-lg text-sm text-gray-400 border-gray-200 cursor-not-allowed"
                                                disabled>Superb</button>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 class="font-bold text-gray-900 mb-3">Storage</h3>
                                        <button
                                            class="px-4 py-2 border-2 border-cyan-500 bg-cyan-50 text-cyan-700 font-bold rounded-lg text-sm">
                                            <%= laptop.specifications.ram %> / <%= laptop.specifications.storage %>
                                        </button>
                                    </div>

                                    <div>
                                        <h3 class="font-bold text-gray-900 mb-3">Operating System</h3>
                                        <button
                                            class="px-4 py-2 border-2 border-cyan-500 bg-cyan-50 text-cyan-700 font-bold rounded-lg text-sm">
                                            <%= laptop.specifications.os || 'Windows 10 / 11' %>
                                        </button>
                                    </div>
                                </div>

                                <!-- Technical Specifications (Right Column) -->
                                <div class="mt-8">
                                    <h3 class="font-bold text-gray-900 mb-3">Technical Specifications</h3>
                                    <div class="grid grid-cols-2 gap-4 text-sm">
                                        <div class="bg-gray-50 p-3 rounded">
                                            <span class="text-gray-500 block text-xs">Processor</span>
                                            <span class="font-medium text-gray-900">
                                                <%= laptop.specifications.processor %>
                                            </span>
                                        </div>
                                        <div class="bg-gray-50 p-3 rounded">
                                            <span class="text-gray-500 block text-xs">RAM</span>
                                            <span class="font-medium text-gray-900">
                                                <%= laptop.specifications.ram %>
                                            </span>
                                        </div>
                                        <div class="bg-gray-50 p-3 rounded">
                                            <span class="text-gray-500 block text-xs">Storage</span>
                                            <span class="font-medium text-gray-900">
                                                <%= laptop.specifications.storage %>
                                            </span>
                                        </div>
                                        <div class="bg-gray-50 p-3 rounded">
                                            <span class="text-gray-500 block text-xs">Display</span>
                                            <span class="font-medium text-gray-900">
                                                <%= laptop.specifications.display %>
                                            </span>
                                        </div>
                                        <div class="bg-gray-50 p-3 rounded">
                                            <span class="text-gray-500 block text-xs">Operating System</span>
                                            <span class="font-medium text-gray-900">
                                                <%= laptop.specifications.os || 'N/A' %>
                                            </span>
                                        </div>
                                        <% if(laptop.specifications.graphics) { %>
                                            <div class="bg-gray-50 p-3 rounded">
                                                <span class="text-gray-500 block text-xs">Graphics</span>
                                                <span class="font-medium text-gray-900">
                                                    <%= laptop.specifications.graphics %>
                                                </span>
                                            </div>
                                            <% } %>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Similar Products (You May Also Like) -->
                    <% if(similarLaptops && similarLaptops.length> 0) { %>
                        <div class="mt-12 mb-12">
                            <h2 class="text-2xl font-bold text-gray-900 mb-6">You May Also Like</h2>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                                <% similarLaptops.forEach(item=> {
                                    const itemDiscount = item.mrp - item.price;
                                    const itemDiscountPercent = Math.round((itemDiscount / item.mrp) * 100);
                                    %>
                                    <a href="/laptop/<%= item._id %>"
                                        class="bg-white border border-gray-200 rounded-lg p-3 hover:shadow-lg transition-all duration-300 flex flex-col relative group">

                                        <!-- Header Badges -->
                                        <div class="flex justify-between items-start w-full relative z-10 mb-2">
                                            <div
                                                class="bg-gray-900 text-white text-[10px] font-bold px-2 py-0.5 rounded flex items-center gap-1">
                                                <i class="fas fa-check-circle text-cyan-400 text-[10px]"></i>
                                                <span>RG COMPUTERS ASSURED</span>
                                            </div>
                                            <% if(item.stockQuantity < 5 && item.stockQuantity> 0) { %>
                                                <div
                                                    class="border border-red-500 text-red-500 text-[10px] font-bold px-2 py-0.5 rounded">
                                                    <%= item.stockQuantity %> left
                                                </div>
                                                <% } %>
                                        </div>

                                        <!-- Image -->
                                        <div
                                            class="relative w-full h-48 mb-3 flex items-center justify-center bg-gray-50 rounded-lg p-4 overflow-hidden">
                                            <img src="<%= item.imageUrls[0] %>" alt="<%= item.brand %>"
                                                class="max-h-full max-w-full object-contain mix-blend-multiply transition-transform duration-300 group-hover:scale-105">
                                        </div>

                                        <!-- Discount Tag -->
                                        <div class="mb-2">
                                            <span
                                                class="bg-green-50 text-cyan-600 text-[10px] font-bold px-1.5 py-0.5 rounded">&#8377;
                                                <%= itemDiscount.toLocaleString('en-IN') %> OFF</span>
                                        </div>

                                        <!-- Title -->
                                        <h3
                                            class="font-bold text-gray-900 text-sm leading-tight mb-2 line-clamp-2 min-h-[40px]">
                                            <%= item.brand %>
                                                <%= item.model %>
                                        </h3>

                                        <!-- Specs -->
                                        <div class="flex flex-wrap gap-2 mb-3">
                                            <span
                                                class="bg-gray-100 text-gray-600 text-[10px] font-medium px-2 py-1 rounded">
                                                <%= item.specifications.ram %>
                                            </span>
                                            <span
                                                class="bg-gray-100 text-gray-600 text-[10px] font-medium px-2 py-1 rounded">
                                                <%= item.specifications.storage %>
                                            </span>
                                            <% if(item.specifications.processor) { %>
                                                <span
                                                    class="bg-gray-100 text-gray-600 text-[10px] font-medium px-2 py-1 rounded">
                                                    <%= item.specifications.processor %>
                                                </span>
                                                <% } %>
                                        </div>

                                        <!-- Rating Section -->
                                        <div class="flex items-center gap-2 mb-3">
                                            <div
                                                class="border border-gray-200 px-1 py-0.5 rounded flex items-center gap-1">
                                                <span class="text-xs font-bold text-gray-700">4.8</span>
                                                <i class="fas fa-star text-yellow-400 text-[10px]"></i>
                                            </div>
                                        </div>

                                        <!-- Price Section -->
                                        <div class="flex items-center gap-2">
                                            <span class="text-red-500 text-sm font-medium">-<%= itemDiscountPercent %>
                                                    %</span>
                                            <span class="text-lg font-bold text-gray-900">&#8377;<%=
                                                    item.price.toLocaleString('en-IN') %></span>
                                            <span
                                                class="text-xs text-gray-400 line-through text-decoration-line-through decoration-gray-400">&#8377;
                                                <%= item.mrp.toLocaleString('en-IN') %></span>
                                        </div>
                                    </a>
                                    <% }) %>
                            </div>
                        </div>
                        <% } %>

                </div>
            </main>

            <%- include('../partials/footer.ejs') %>

                <script>
                    function changeImage(url, element) {
                        // Update main image
                        document.getElementById('main-image').src = url;

                        // Update active state of thumbnails
                        // Desktop
                        const desktopThumbnails = element.parentElement.children;
                        for (let thumb of desktopThumbnails) {
                            thumb.classList.remove('border-cyan-500');
                            thumb.classList.add('border-gray-200');
                        }
                        element.classList.remove('border-gray-200');
                        element.classList.add('border-cyan-500');

                        // If called from mobile, we might need to sync or just ignore cross-sync for simplicity now
                    }
                </script>
    </body>

    </html>
