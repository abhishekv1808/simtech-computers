<%- include('../partials/head.ejs') %>
<body class="bg-gray-50 font-sans text-gray-600">
    
    <!-- Top Navigation (Matched to Dashboard) -->
    <nav class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6">
            <div class="flex justify-between h-16">
                <!-- Logo & Nav Links -->
                <div class="flex items-center">
                    <a href="/admin/dashboard" class="flex items-center text-blue-600 text-xl font-extrabold tracking-tight mr-10">
                        <i class="fas fa-microchip mr-2"></i> SimTech
                    </a>
                    <div class="hidden md:flex space-x-1">
                        <a href="/admin/dashboard" class="px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-900 hover:bg-gray-50 rounded-md">Dashboard</a>
                        <a href="/admin/inventory" class="px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-900 hover:bg-gray-50 rounded-md">Inventory</a>
                        <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-900 hover:bg-gray-50 rounded-md">Orders</a>
                        <a href="#" class="px-3 py-2 text-sm font-medium text-gray-500 hover:text-gray-900 hover:bg-gray-50 rounded-md">Customers</a>
                    </div>
                </div>

                <!-- Right Side Actions -->
                <div class="flex items-center space-x-4">
                    <button class="text-gray-400 hover:text-gray-500">
                        <i class="far fa-bell text-lg"></i>
                    </button>
                    <div class="flex items-center gap-3 pl-4 border-l border-gray-200">
                        <div class="text-right hidden sm:block">
                            <p class="text-sm font-semibold text-gray-900">Admin User</p>
                            <p class="text-xs text-gray-500">Manager</p>
                        </div>
                        <div class="h-9 w-9 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold border border-blue-200">
                            A
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-4xl mx-auto px-6 py-8">
        
        <!-- Breadcrumb & Title -->
        <div class="mb-8 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
                <a href="/admin/dashboard" class="text-sm text-gray-500 hover:text-blue-600 mb-2 inline-flex items-center transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i> Back to Inventory
                </a>
                <h1 class="text-3xl font-bold text-gray-900 tracking-tight"><%= editing ? 'Edit Product' : 'Add New Product' %></h1>
                <p class="text-gray-500 mt-1">Fill in the details below to <%= editing ? 'update the product in' : 'add a new product to' %> your catalog.</p>
            </div>
            <% if (editing) { %>
                <div class="px-4 py-2 bg-blue-50 text-blue-700 rounded-lg text-sm font-medium border border-blue-100">
                    Editing SKU: <span class="font-mono ml-1 text-blue-800"><%= laptop._id %></span>
                </div>
            <% } %>
        </div>

        <form action="/admin/<%= editing ? 'edit-laptop' : 'add-laptop' %>" method="POST" class="space-y-8 pb-12">
            
            <!-- Main Info Card -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="p-6 border-b border-gray-50 bg-gray-50/50 flex items-center gap-3">
                    <div class="h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                        <i class="fas fa-box-open text-xs"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-900">Basic Information</h3>
                </div>
                
                <div class="p-6 space-y-8">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="group">
                            <label class="block text-sm font-medium text-gray-700 mb-2 group-focus-within:text-blue-600 transition-colors" for="brand">Brand</label>
                            <div class="relative">
                                <select class="w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white appearance-none cursor-pointer hover:border-blue-300" id="brand" name="brand" required>
                                    <option value="" disabled <%= !editing ? 'selected' : '' %>>Select Brand</option>
                                    <% const brands = ['Dell', 'HP', 'Lenovo', 'Apple', 'Acer']; %>
                                    <% brands.forEach(brand => { %>
                                        <option value="<%= brand %>" <%= editing && laptop.brand === brand ? 'selected' : '' %>><%= brand %></option>
                                    <% }) %>
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-gray-400">
                                    <i class="fas fa-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>
                        <div class="group">
                            <label class="block text-sm font-medium text-gray-700 mb-2 group-focus-within:text-blue-600 transition-colors" for="model">Model Name</label>
                            <input class="w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all placeholder-gray-400" id="model" type="text" name="model" value="<%= editing ? laptop.model : '' %>" placeholder="e.g. XPS 15 9520" required>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <div class="group">
                            <label class="block text-sm font-medium text-gray-700 mb-2 group-focus-within:text-blue-600 transition-colors" for="mrp">MRP</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <span class="text-gray-400 font-medium">₹</span>
                                </div>
                                <input class="w-full pl-8 pr-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all font-medium text-gray-900" id="mrp" type="number" step="0.01" name="mrp" value="<%= editing ? laptop.mrp : '' %>" placeholder="0.00" required>
                            </div>
                            <p class="text-xs text-gray-400 mt-1">Official market price</p>
                        </div>
                        <div class="group">
                            <label class="block text-sm font-medium text-gray-700 mb-2 group-focus-within:text-blue-600 transition-colors" for="price">Our Price</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <span class="text-gray-400 font-medium">₹</span>
                                </div>
                                <input class="w-full pl-8 pr-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all font-bold text-gray-900" id="price" type="number" step="0.01" name="price" value="<%= editing ? laptop.price : '' %>" placeholder="0.00" required>
                            </div>
                            <p class="text-xs text-blue-500 mt-1 font-medium">Selling price</p>
                        </div>
                        <div class="group">
                             <label class="block text-sm font-medium text-gray-700 mb-2 group-focus-within:text-blue-600 transition-colors">Product Images</label>
                             <div id="image-url-wrapper" class="relative">
                                <!-- Dynamic Image Fields Container -->
                                <div id="image-urls-container" class="space-y-2">
                                    <% 
                                        let imageUrls = [''];
                                        if (editing) {
                                            if (laptop.imageUrls && laptop.imageUrls.length > 0) {
                                                imageUrls = laptop.imageUrls;
                                            } else if (laptop.imageUrl) {
                                                imageUrls = [laptop.imageUrl];
                                            }
                                        }
                                    %>
                                    <% imageUrls.forEach((url, index) => { %>
                                    <div class="flex gap-2">
                                        <div class="relative flex-grow">
                                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                                                <i class="fas fa-link text-xs"></i>
                                            </div>
                                            <input class="w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" type="text" name="imageUrls" value="<%= url %>" placeholder="https://image-url.com/..." required>
                                        </div>
                                        <% if (index === 0) { %>
                                            <button type="button" onclick="addImageField()" class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" title="Add another image URL">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        <% } else { %>
                                            <button type="button" onclick="removeImageField(this)" class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" title="Remove URL">
                                                <i class="fas fa-trash-alt text-xs"></i>
                                            </button>
                                        <% } %>
                                    </div>
                                    <% }) %>
                                </div>
                             </div>
                        </div>
                    </div>

                    <div class="group">
                        <label class="block text-sm font-medium text-gray-700 mb-2 group-focus-within:text-blue-600 transition-colors" for="description">Product Description</label>
                        <textarea class="w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all leading-relaxed placeholder-gray-400 shadow-sm" id="description" name="description" rows="5" placeholder="Write a detailed description highlighting key features..." required><%= editing ? laptop.description : '' %></textarea>
                    </div>
                </div>
            </div>

            <!-- Inventory Details Card -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="p-6 border-b border-gray-50 bg-gray-50/50 flex items-center gap-3">
                    <div class="h-8 w-8 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600">
                         <i class="fas fa-boxes text-xs"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-900">Inventory Status</h3>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="group">
                            <label class="block text-sm font-medium text-gray-700 mb-2 group-focus-within:text-blue-600 transition-colors" for="stockQuantity">Stock Quantity</label>
                            <input class="w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all font-mono" id="stockQuantity" type="number" name="stockQuantity" value="<%= editing ? laptop.stockQuantity : '0' %>" min="0" required>
                        </div>
                        <div class="group">
                            <label class="block text-sm font-medium text-gray-700 mb-2 group-focus-within:text-blue-600 transition-colors" for="status">Availability Status</label>
                            <div class="relative">
                                <select class="w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-white appearance-none cursor-pointer" id="status" name="status" required>
                                    <option value="In Stock" <%= editing && laptop.status === 'In Stock' ? 'selected' : '' %>>In Stock</option>
                                    <option value="Low Stock" <%= editing && laptop.status === 'Low Stock' ? 'selected' : '' %>>Low Stock</option>
                                    <option value="Out of Stock" <%= editing && laptop.status === 'Out of Stock' ? 'selected' : '' %>>Out of Stock</option>
                                    <option value="Discontinued" <%= editing && laptop.status === 'Discontinued' ? 'selected' : '' %>>Discontinued</option>
                                </select>
                                <div class="absolute inset-y-0 right-0 flex items-center px-4 pointer-events-none text-gray-400">
                                    <i class="fas fa-chevron-down text-xs"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Specs Card -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
                <div class="p-6 border-b border-gray-50 bg-gray-50/50 flex items-center gap-3">
                    <div class="h-8 w-8 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600">
                        <i class="fas fa-memory text-xs"></i>
                    </div>
                    <h3 class="text-lg font-bold text-gray-900">Technical Specifications</h3>
                </div>
                
                <div class="p-6">
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                        <div class="group">
                            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2 pl-1" for="processor">Processor</label>
                            <input class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-gray-50 hover:bg-white focus:bg-white" id="processor" type="text" name="processor" value="<%= editing ? laptop.specifications.processor : '' %>" placeholder="e.g. Intel Core i7-12700H">
                        </div>
                        <div class="group">
                            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2 pl-1" for="ram">Memory (RAM)</label>
                            <input class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-gray-50 hover:bg-white focus:bg-white" id="ram" type="text" name="ram" value="<%= editing ? laptop.specifications.ram : '' %>" placeholder="e.g. 16GB DDR5">
                        </div>
                        <div class="group">
                            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2 pl-1" for="storage">Storage</label>
                            <input class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-gray-50 hover:bg-white focus:bg-white" id="storage" type="text" name="storage" value="<%= editing ? laptop.specifications.storage : '' %>" placeholder="e.g. 1TB NVMe SSD">
                        </div>
                        <div class="group">
                            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2 pl-1" for="display">Display</label>
                            <input class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-gray-50 hover:bg-white focus:bg-white" id="display" type="text" name="display" value="<%= editing ? laptop.specifications.display : '' %>" placeholder="e.g. 15.6 inch 4K OLED">
                        </div>
                        <div class="md:col-span-2 group">
                            <label class="block text-xs font-bold text-gray-500 uppercase tracking-wide mb-2 pl-1" for="graphics">Graphics Card</label>
                            <input class="w-full px-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all bg-gray-50 hover:bg-white focus:bg-white" id="graphics" type="text" name="graphics" value="<%= editing ? laptop.specifications.graphics : '' %>" placeholder="e.g. NVIDIA GeForce RTX 3060 6GB">
                        </div>
                    </div>
                </div>
            </div>

            <% if (editing) { %>
                <input type="hidden" name="laptopId" value="<%= laptop._id %>">
            <% } %>

            <div class="flex items-center justify-end gap-3 pt-4">
                <a href="/admin/inventory" class="px-6 py-3 border border-gray-300 rounded-xl text-sm font-semibold text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-colors">
                    Cancel
                </a>
                <button type="submit" class="px-6 py-3 bg-blue-600 border border-transparent rounded-xl text-sm font-semibold text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 shadow-lg shadow-blue-200 transition-all flex items-center">
                    <i class="fas fa-save mr-2"></i> <%= editing ? 'Update Product' : 'Create Product' %>
                </button>
            </div>
        </form>
    </div>

    <!-- Script for Dynamic Image Fields -->
    <script>
        function addImageField() {
            const container = document.getElementById('image-urls-container');
            const div = document.createElement('div');
            div.className = 'flex gap-2 animate-pulse-slight';
            div.innerHTML = `
                <div class="relative flex-grow">
                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400">
                        <i class="fas fa-link text-xs"></i>
                    </div>
                    <input class="w-full pl-9 pr-4 py-2.5 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" type="text" name="imageUrls" placeholder="https://image-url.com/..." required>
                </div>
                <button type="button" onclick="removeImageField(this)" class="flex-shrink-0 w-10 h-10 flex items-center justify-center bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500" title="Remove URL">
                    <i class="fas fa-trash-alt text-xs"></i>
                </button>
            `;
            container.appendChild(div);
            // Remove animation class after render
            setTimeout(() => div.classList.remove('animate-pulse-slight'), 500);
        }

        function removeImageField(btn) {
            const row = btn.closest('div.flex');
            row.style.opacity = '0';
            setTimeout(() => row.remove(), 200);
        }
    </script>
    <style>
        .animate-pulse-slight {
            animation: pulse-slight 0.3s ease-out;
        }
        @keyframes pulse-slight {
            0% { opacity: 0; transform: translateY(-5px); }
            100% { opacity: 1; transform: translateY(0); }
        }
    </style>
</body>
</html>
